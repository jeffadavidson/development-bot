name: Development-Bot-Runs
run-name: Development-Bot-Runs-${{ github.run_number }}
on:
  #workflow_dispatch for manual triggering
  workflow_dispatch: 
  # Schedule 3PM UTC/9AM MT for just kgca-development/killarney-development main branch
  schedule:
    - cron: '00 16 * * *'

# Need to grant actions token write permissions to be able to push to git repo
permissions:
  contents: write

jobs:
  test:
    # Onjy run if in the proper repository
    if: (github.event_name == 'schedule' && github.repository == 'jeffadavidson/development-bot') || (github.event_name != 'schedule')
    name: Execute Script
    runs-on: ubuntu-latest
    env:
      DEVELOPMENT_BOT_GITHUB_PAT: ${{ secrets.DEVELOPMENT_BOT_GITHUB_PAT }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.20.1'
      - name: Install dependencies
        run: go mod download
      - name: Execute Script
        run: go run main.go
      - name: Commit Data Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/
          git commit -m "Update data" || true
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
